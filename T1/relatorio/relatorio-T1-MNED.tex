\documentclass[12pt,a4paper,portuguese]{article}

\usepackage[brazil]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[margin=1.5cm]{geometry}
\usepackage{graphicx}
\usepackage{float}
\usepackage{tikz}
\usetikzlibrary{arrows.meta,decorations.markings,decorations.pathmorphing}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}

\usepackage{hyperref}
\hypersetup{
	hidelinks,
	linkcolor = blue
} % Changes the link color to black and hides the hideous red border that usually is created

\setcounter{section}{-1}

\begin{document}
    % Título
    \vspace{5mm}
    \rule{0.95\textwidth}{1pt}
    \vspace{3mm}
    \begin{center}
        \textbf{\huge Equações Elípticas} \\
        \Large Trabalho 1 \\
        \large SME0202 Métodos Numéricos em Equações Diferenciais
    
        \vspace{8mm}
        \begin{tabular}{rcl}
            Cody Stefano Barham Setti &-- &4856322 \\
            Ian de Holanda Cavalcanti Bezerra &-- &13835412
        \end{tabular}

    \vspace{8mm}
    25 de Abril de 2025
    \end{center}

    \vspace{1mm}
    \rule{0.95\textwidth}{1pt}
    \vspace{0.5cm}

    % Corpo do texto
    \section{PVC de Interesse}
    Para o domínio retangular $\Omega = [0,1]\times[-1,1]$, queremos resolver a seguinte equação de convecção-difusão anisotrópica em regime estacionário:
    \begin{equation*}
        \frac{\partial^2 u}{\partial x^2} + 3\frac{\partial^2 u}{\partial y^2} = c\frac{\partial u}{\partial y}.
    \end{equation*}
    com condição de Dirichlet $u(0,y)=u(1,y)=0$ em seus bordos verticais, de Robin no bordo superior e de Neumann no inferior, conforme a figura abaixo.
    \begin{figure}[H]
        \centering
        \begin{tikzpicture}[
            > = Stealth,
            scale=1.8,
            boundary label/.style={font=\scriptsize},
            normal vector/.style={->, thick, olive, shorten >=1pt},
            point label/.style={font=\scriptsize}
        ]
            % Define coordinates
            \coordinate (A) at (0,-1);  % Bottom-left
            \coordinate (B) at (1,-1);  % Bottom-right
            \coordinate (C) at (1,1);   % Top-right
            \coordinate (D) at (0,1);   % Top-left
            \coordinate (O) at (0,0);   % Origin
            
            % Draw domain
            \fill[blue!10] (A) rectangle (C);
            
            % Draw axis (minimized)
            \draw[->, thin] (-0.25,0) -- (1.4,0) node[right, font=\scriptsize] {$x$};
            \draw[->, thin] (0,-1.25) -- (0,1.25) node[above, font=\scriptsize] {$y$};
            
            % Draw domain boundaries
            \draw[very thick] (A) -- (B) -- (C) -- (D) -- cycle;
            
            
            % Boundary conditions
            % Left vertical boundary (Dirichlet)
            \draw[red, very thick] (D) -- (A);
            \node[boundary label, anchor=east] at (0,0.3) {$u = 0$};
            
            % Right vertical boundary (Dirichlet)
            \draw[red, very thick] (C) -- (B);
            \node[boundary label, anchor=west] at (1,0.3) {$u = 0$};
            
            % Bottom boundary (Neumann)
            \draw[blue, very thick] (A) -- (B);
            \node[boundary label, anchor=north] at (0.5,-1.4) {$(\nabla u \cdot \mathbf{n})\vert_{(x,-1)} = e\sin(2\pi x)$};

            % Normal vectors with labels
            \draw[normal vector] (0.5,-1) -- (0.5,-1.2) node[below, olive, font=\scriptsize] {$\mathbf{n}$};
            \draw[normal vector] (0.5,1) -- (0.5,1.2) node[above, olive, font=\scriptsize] {$\mathbf{n}$};

            % Top boundary (Robin)
            \draw[blue, very thick] (D) -- (C);
            \node[boundary label, anchor=south] at (0.5,1.4) {$(\nabla u \cdot \mathbf{n} + u)\vert_{(x,1)} = 0$};
            
            % Mark coordinates with dots
            \foreach \coord/\pos/\label in {
                {(0,-1)}/below left/{(0,-1)},
                {(1,-1)}/below right/{(1,-1)},
                {(1,1)}/above right/{(1,1)},
                {(0,1)}/above left/{(0,1)},
                {(0,0)}/below right/{O}
            } {
                \fill[red] \coord circle (1pt);
                \node[point label, \pos, inner sep=1pt] at \coord {\label};
            }
        \end{tikzpicture}
        \caption{Domínio $\Omega = [0,1] \times [-1,1]$ com suas condições de contorno}
        \label{fig:domain}
    \end{figure}

    Para $c=4\pi^2-3$, tal problema de valor de contorno (PVC) possui solução analítica
    \begin{equation*}
        u(x,y) = e^{-y}\sin(2\pi x).
    \end{equation*}
    Entretanto, elaboremos um esquema para solucioná-la numericamente.

    \section{Solução Numérica e Seu Gráfico}
    \subsection{Discretização do Domínio (Geração da Malha)}
    Primeiramente, para discretizar o domínio, utilizaremos uma malha uniforme, com espaçamento $h$ em ambas as direções. Logo, o eixo-x do domínio torna-se o conjunto discreto $\{0,h,2h,\ldots,1-h,1\}$, de $N_x=\frac{1}{h}+1$ pontos, e o eixo-y torna-se o conjunto discreto $\{-1,-1+h,-1+2h,\ldots,1-h,1\}$, de $N_y=\frac{1-(-1)}{h}+1=\frac{2}{h}+1$ pontos. Portanto, no total, o domínio será composto de $N_x\times N_y$ pontos.

    Todavia, vale salientar que, como as laterais do domínio são de Dirichlet, por mais que a malha terá $N_x\times N_y$ pontos, teremos apenas $N \coloneq (N_x-2)\times N_y$ incógnitas.

    \subsection{Discretização do PVC (Construção do Sistema Linear)}
    Agora que esta clara a disposição dos pontos da malha (e quais deles são incógnitas), está claro que transformaremos nosso PVC em um sistema linear de dimensões
    \begin{equation*}
        A_{N\times N}U_{N\times 1} = F_{N\times 1},
    \end{equation*}
    lembrando que $N \coloneq (N_x-2)\times N_y$.

    \subsubsection{Pontos Interiores}
    Primeiramente, para os pontos interiores de nosso domínio, a partir de um estêncil de $5$ pontos em formato de cruz, temos uma discretização conveniente para a EDP, que nos produz, para cada ponto interior, uma respectiva equação linear.
    
    Mais precisamente, já que queremos uma precisão de ordem $2$, aproximaremos as derivadas segundas por uma diferença centrada de $3$ pontos, ao passo que, para a derivada primeira, basta uma diferença centrada de $2$ pontos. Logo, teremos as equações lineares:

    \begin{align*}
        \frac{U_{i+1j}-2U_{ij}+U_{i-1j}}{h^2} + 3\left(\frac{U_{ij+1}-2U_{ij}+U_{ij-1}}{h^2}\right) &= c\left(\frac{U_{ij+1}-U_{ij-1}}{2h}\right).
    \intertext{Logo, isolando as incógnitas do lado esquerdo da equação,}
        \left(\tfrac{3}{h^2}+\tfrac{c}{h}\right)U_{ij-1} + \Bigl[U_{i-1j} -\tfrac{8}{h^2}U_{ij} + \tfrac{1}{h^2}U_{i+1j}\Bigr] + \left(\tfrac{3}{h^2}-\tfrac{c}{2h}\right)U_{ij+1} &= 0.
    \end{align*}
    Vale salientar duas coisas:
    \begin{enumerate}
        \item Para os pontos interiores da forma $(i,1)$ e $(i,N_y-1)$, haverão índices que passam dos limites de indexação das incógnitas. Entende-se que, para tais pontos, os termos de índices fora de escopo devem ser tomados como sendo nulos, o que corresponde às condições de contorno de Dirichlet $u(x,-1)=u(x,1)=0$.

        \item Ademais, os índices da forma bidimensional $(i,j)$ são utilizados apenas por conveniência, já que remetem claramente ao formato do domínio. Entretanto, para a montagem do sistema linear, eles são, na realidade, reindexados com um único índice $k$, seguindo a ordem natural de ordenação da malha, isto é, dados $i,j$, o respectivo $k$ terá valor $k=(i-1)N_y+j$.
    \end{enumerate}

    \subsubsection{Bordo Superior}
    Os pontos da malha no bordo superior, isto é, da forma $(i,N_y)$, também têm valor desconhecido. Determinamo-nos por meio da condição de Robin
    \begin{align*}
        \left(\nabla u\cdot\boldsymbol{n}+u\right)\vert_{(x,1)} &= 0, &&\forall x\in[0,1].
    \shortintertext{Isto é,}
        \begin{bmatrix}
            \tfrac{\partial u}{\partial x} \\
            \tfrac{\partial u}{\partial y}
        \end{bmatrix}\cdot
        \begin{bmatrix}
            0 \\
            1
        \end{bmatrix}
        +u &= 0, &&\forall x\in[0,1].
    \intertext{Ou, mais simplesmente,}
        \tfrac{\partial u}{\partial y} + u &= 0, &&\forall x\in[0,1].
    \end{align*}
    Portanto, novamente, para obter convergência de ordem $2$, discretizaremos tal ED por uma diferença \textbf{progressiva} para $\frac{\partial u}{\partial y}$ utilizando $3$ pontos:
    \begin{align*}
        \frac{3U_{ij}-4U_{ij+1}+U_{ij+2}}{2h} + U_{ij} &= 0.
    \intertext{Reorganizando os índices em ordem crescente,}
     \left(\tfrac{3}{2h}+1\right)U_{ij} -\tfrac{4}{2h}U_{ij+1} +   \tfrac{1}{2h}U_{ij+2} &= 0.
    \end{align*}

    \subsubsection{Bordo Inferior}
    Os pontos da malha no bordo inferior, aqueles da forma $(i,1)$, por fim, também têm valor desconhecido. Determinemo-nos pela condição de Neumann
    \begin{align*}
        \left(\nabla u\cdot\boldsymbol{n}\right)\vert_{(x,-1)} &= e\sin(2\pi x), &&\forall x\in[0,1].
    \shortintertext{Isto é,}
        \begin{bmatrix}
            \tfrac{\partial u}{\partial x} \\
            \tfrac{\partial u}{\partial y}
        \end{bmatrix}\cdot
        \begin{bmatrix}
            0 \\
            -1
        \end{bmatrix}
         &= e\sin(2\pi x), &&\forall x\in[0,1].
    \intertext{Ou, mais simplesmente,}
        \tfrac{\partial u}{\partial y} &= -e\sin(2\pi x), &&\forall x\in[0,1].
    \end{align*}
    Portanto, novamente, para obter convergência de ordem $2$, discretizaremos tal ED por uma diferença \textbf{regressiva} para $\frac{\partial u}{\partial y}$ utilizando $3$ pontos:
    \begin{align*}
        \frac{3U_{ij}-4U_{ij-1}+U_{ij-2}}{2h} &= -e\sin(2\pi x_{ij}).
    \intertext{Reorganizando os índices em ordem crescente,}
        \tfrac{1}{2h}U_{ij-2} -\tfrac{4}{2h}U_{ij-1} +\tfrac{3}{2h}U_{ij} &= -e\sin(2\pi x).
    \end{align*}
    Vale salientar que apenas para esses pontos as respectivas componentes do termo independente são não nulas, assumindo o valor $-e\sin(2\pi x_{ij})$.

    \subsection{Gráfico da Solução Numérica}
    Com a discretização descrita acima, tomando-se um passo $h=0.01$, chegamos na solução numérica mostrada na figura a seguir:
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.5\textwidth]{imagens/numerica.png}
        \caption{}
        \label{fig:solucao-numerica}
    \end{figure}

    \section{Solução Exata e Análise dos Erros na Aproximação}
    \subsection{Gráfico da Solução Exata}
    Avaliando-se os valores exatos da função-solução do PVC nos mesmos pontos do domínio utilizados para construir-se a malha da solução numérica, obtemos a figura a seguir:
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.5\textwidth]{imagens/exata.png}
        \caption{}
        \label{fig:solucao-exata}
    \end{figure}

    \subsection{Análise dos Erros na Aproximação}
    Agora, com tanto a solução numérica, quanto a exata em mãos, basta calcularmos a diferença absoluta entre seus valores em cada ponto da malha que sai de imediato o \emph{heat-map} abaixo, identificando as regiões do domínio onde a aproximação é mais e menos fidedigna:
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.6\textwidth]{imagens/heatmap.png}
        \caption{}
        \label{fig:heatmap}
    \end{figure}

    Claramente, a região de maior erro é onde a temperatura da chapa varia mais violentamente. Isso é natural de se esperar, pois os valores da função nessa região é maior, com isso é natural esperar que o erro absoluto aumente, hipotetizamos que o erro relativo seja similar em todo o domínio. 

    Ademais, fizemos um gráfico do erro (com sinal, nao valor absoluto) no mesmo formato tridimensional dos das soluções numérica e exata, apenas para tornar ainda mais fácil a localização das regiões do domínio onde um erro maior é cometido na aproximação. Vide-o abaixo:
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.5\textwidth]{imagens/erro_sinal.png}
        \caption{}
        \label{fig:erro_sinal}
    \end{figure}

   Por curiosidade notamos também que na região côncava do domínio o erro com sinal é negativo e na região convexa o erro com sinal é positivo.

    \section{Análise de Convergência}
    Por fim, analisemos o erro global cometido para diferentes valores de espaçamento $h$, cada vez menores.
    
    No caso, por erro global, já que temos a solução exata em mãos, entendemo-lo como sendo a média aritmética dos erros em cada ponto da malha (erros locais).

    O decaimento do erro global é mostrado no gráfico abaixo:
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.7\textwidth]{imagens/analise_conv.png}
        \caption{}
        \label{fig:analise_conv}
    \end{figure}
    Como esperado, a convergência à solução exata é praticamente de ordem $2$.
\end{document}